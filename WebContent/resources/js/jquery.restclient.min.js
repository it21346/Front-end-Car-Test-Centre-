!function(t){t.RestClient=function(e,r){"object"==typeof e?r={api:e}:"object"==typeof r?r.api=e:r={api:e};var i="jQuery-Rest-Client",n=t.extend({waitingTime:300,waitLoopLimit:60,logger:0,fnError:function(t){},setup:{cache:!1,dataType:"json",headers:{}}},r||{}),h=function(t){n.logger<=1&&console.log(i+": "+t)},s=function(t){n.logger<=2&&console.error(i+": "+t)},u=function(t){s(t),n.fnError(t)},c={},o=null,a=0,d=!1,l=function(e,r){var i=e.parent>-1&&e.waiting?e.waiting:o;if(!i||c[i]){var s=t.extend(n.setup||{},e.current.setup),a=t.extend({method:e.current.method,url:n.api+"/"+e.url+e.current.path,success:r||null,cache:n.cache,headers:e.current.headers},s);return"POST"==e.current.method||"PUT"==e.current.method?a.data=e.current.data:"GET"==e.current.method&&(a.data=t.extend(e.current.query||{},e.current.data||{})),t.ajax(a)}if(h("Trying... "+e.key),!(e.waitingCount<n.waitLoopLimit))return u("Wait too long, canceled operation. ["+e.key+":"+e.section+"]");var d=function(){++e.waitingCount,l(e,r)};setTimeout(d,n.waitingTime)},f=function(e,r){return this.waitingCount=0,this.section=e,this.url=r,this.parent=-1,this.waiting=null,this.key=a++,this.current=this.currentClean={method:null,query:null,data:null,path:"",headers:{}},this.childrens=[],this.wait=function(t){return c[t]===!0?this:(c[t]=!1,this.parent>-1?(h("WAIT REGISTRY IN PARENT: "+t+" by "+this.key),this.waiting=t):(h("WAIT REGISTRY WHIOUT PARENT: "+t+" by "+this.key),o=t),this)},this.release=function(t){return c[t]=!0,h("WAIT UNREGISTRED: "+t+" by "+this.key),this},this.setApi=function(t){return n.api=r=t,this},this.add=function(t,e){if("object"!=typeof t){this.childrens.push(t);var r=e||t;this.url&&(r=this.url+"/"+r),this[t]=new f(t,r),this[t].parent=this.key}else for(var i in t)this.add(i,t[i])},this.query=function(t,e){return"object"==typeof t?this.current.query=t:(this.current.query={},this.current.query[t]=e),this.current.method||(this.current.method="GET"),this},this.data=function(t,e){return"object"==typeof t?this.current.data=t:(this.current.data={},this.current.data[t]=e),this.current.method||(this.current.method="POST"),this},this.defaultHeaders=function(e){return n.setup.headers=t.extend(n.setup.headers,e||{}),this},this.headers=function(e){return this.current.headers=t.extend(this.current.headers,e||{}),this},this.method=function(t){return this.current.method=t,this},this.isPost=function(){return this.current.method="POST",this},this.isGet=function(){return this.current.method="GET",this},this.isPut=function(){return this.current.method="PUT",this},this.isDelete=function(){return this.current.method="DELETE",this},this.token=function(t,e){this.defaultHeaders({"x-access-token":t,"x-key":e})},this.clear=function(t){t?current=currentClean:(this.current.query=null,this.current.data=null,this.current.method=null,this.current.setup={},d||(this.current.path=""))},this.error=function(t){return n.fnError=t,this},this.read=function(t){return this.clear(),"object"==typeof t?(this.current.query=t,this.current.path=""):this.current.path="/"+t,this.current.method="GET",this},this.create=function(t){return this.clear(),this.current.data=t,this.current.method="POST",this},this.update=function(t){return this.clear(),this.current.data=t,this.current.method="PUT",this},this.delete=function(t){return this.clear(),this.current.path="/"+t,this.current.method="DELETE",this},this.custom=function(t){return this.current={method:t.method||null,query:t.query||null,data:t.query||null,path:t.path||"",headers:t.headers||{}},this},this.action=function(t){return d=!0,this.current.path="/"+t,this},this.setup=function(t){return this.current.setup=t,this},this.get=this.read,this.post=this.create,this.insert=this.create,this.del=this.delete,this.remove=this.delete,this.destroy=this.delete,this.then=function(t){return h("Run the "+this.key),d=!1,l(this,t)},this.exec=function(){return h("Run the "+this.key),l(this)},this};return f(n.api)}}(jQuery);